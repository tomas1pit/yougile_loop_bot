# Loop (Mattermost) ‚Üí YouGile Task Bot

–ë–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –≤ **YouGile** –ø—Ä—è–º–æ –∏–∑ —á–∞—Ç–æ–≤ **Loop (Mattermost)**.  
–†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ WebSocket + –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ + API YouGile.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤ —Ç—Ä–µ–¥–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
@yougile_bot —Å–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É –°–¥–µ–ª–∞—Ç—å –æ—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
```

–ò –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –º–∞—Å—Ç–µ—Ä.

---

# üö∂ –ü–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏

1. **–í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞**  
   ‚Äî –ª–∏–±–æ –≤—Ä—É—á–Ω—É—é, –ª–∏–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–µ–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–Ω–∞–ª–∞  
2. **–í—ã–±–æ—Ä –¥–æ—Å–∫–∏**
3. **–í—ã–±–æ—Ä –∫–æ–ª–æ–Ω–∫–∏**
4. **–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ**
5. **–í—ã–±–æ—Ä –¥–µ–¥–ª–∞–π–Ω–∞**
   - –°–µ–≥–æ–¥–Ω—è  
   - –ó–∞–≤—Ç—Ä–∞  
   - –ü–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞  
   - –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é  
   - –ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü  
   - **–ë–µ–∑ –¥–µ–¥–ª–∞–π–Ω–∞**  
   - **–°–≤–æ—è –¥–∞—Ç–∞ (YYYY-MM-DD)**  
6. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ YouGile**
7. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ç—Ä–µ–¥–∞**  
   ‚Äî –≤—Å—ë –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç –∑–∞–¥–∞—á–∏ YouGile  
8. **–†—É—á–Ω–æ–µ –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞**

---

# ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úî –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

```
@yougile_bot —Å–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É <–Ω–∞–∑–≤–∞–Ω–∏–µ>
```

### ‚úî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–Ω–∞–ª–∞  
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª –æ–Ω —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç, –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ª–∏ –ø—Ä–æ–µ–∫—Ç.

### ‚úî –ö–Ω–æ–ø–∫–∞ ¬´–û—Ç–º–µ–Ω–∏—Ç—å¬ª –Ω–∞ –ª—é–±–æ–º —à–∞–≥–µ

### ‚úî –ö—Ä–∞—Å–∏–≤—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–¥–∞—á—É

```
https://ru.yougile.com/team/<teamId>/<projectSlug>#<taskProjectId>
```

### ‚úî –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —á–∞—Ç –∑–∞–¥–∞—á–∏  
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ò–º—è –§–∞–º–∏–ª–∏—è (@username) –Ω–∞–ø–∏—Å–∞–ª: <—Ç–µ–∫—Å—Ç>
```

### ‚úî –ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ  
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –Ω–∞–∂–∞—Ç—å ¬´–ó–∞–≤–µ—Ä—à–∏—Ç—å¬ª, –±–æ—Ç —Å–∞–º –ø–æ–¥–≤–µ–¥—ë—Ç –∏—Ç–æ–≥ —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç.

---

# üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Flask** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π Loop
- **WebSocket Loop (Mattermost)** ‚Äî —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **YouGile REST API**
- **In-memory state** + **–º–∞–ø–ø–∏–Ω–≥ –∫–∞–Ω–∞–ª ‚Üí –ø—Ä–æ–µ–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –º—ç–ø–ø–∏–Ω–≥–∞ –≤ JSON-—Ñ–∞–π–ª–µ** –≤–Ω—É—Ç—Ä–∏ Docker volume

---

# üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+ **–∏–ª–∏ Docker**
- Loop (Mattermost) —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º–∏ Interactive Messages
- API-–∫–ª—é—á YouGile
- –ü—É–±–ª–∏—á–Ω—ã–π URL, –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è Mattermost

---

# ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ

| ENV | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `MM_URL` | URL Loop (–Ω–∞–ø—Ä–∏–º–µ—Ä `https://wave.loop.ru`) |
| `MM_BOT_TOKEN` | Token –±–æ—Ç–∞ Mattermost |
| `MM_BOT_USERNAME` | –õ–æ–≥–∏–Ω –±–æ—Ç–∞, –±–µ–∑ @ |
| `BOT_PUBLIC_URL` | –ü—É–±–ª–∏—á–Ω—ã–π URL –±–æ—Ç–∞ |
| `YOUGILE_COMPANY_ID` | Company ID –≤ YouGile |
| `YOUGILE_API_KEY` | API –∫–ª—é—á YouGile |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

| ENV | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `YOUGILE_BASE_URL` | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `https://ru.yougile.com/api-v2` |
| `YOUGILE_TEAM_ID` | teamId; –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –±–µ—Ä—ë—Ç—Å—è –∏–∑ COMPANY_ID |
| `AUTO_FINISH_TIMEOUT_MINUTES` | –¢–∞–π–º–∞—É—Ç –∞–≤—Ç–æ-–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5) |
| `TZ` | –¢–∞–π–º–∑–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `Europe/Moscow`) |

---

# üê≥ Docker-–∑–∞–ø—É—Å–∫

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± ‚Äî –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose:

```yaml
version: "3.9"

services:
  yg-bot:
    image: yg-bot:latest
    container_name: yg-bot
    restart: unless-stopped
    environment:
      TZ: Europe/Moscow

      MM_URL: "https://loop.example.com"
      MM_BOT_TOKEN: "<loop_bot_token>"
      MM_BOT_USERNAME: "yougile_bot"
      BOT_PUBLIC_URL: "https://yg-bot.example.com"

      YOUGILE_COMPANY_ID: "<yougile_company_id>"
      YOUGILE_API_KEY: "<yougile_api_key>"

    networks:
      - default
    expose:
      - "8000"

    volumes:
      # –•—Ä–∞–Ω–µ–Ω–∏–µ –º—ç–ø–ø–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª ‚Üí –ø—Ä–æ–µ–∫—Ç
      - yougile-bot-data:/data

volumes:
  yougile-bot-data:
    driver: local
```

---

# üó£Ô∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —á–∞—Ç–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç:

   ```
   @yougile_bot —Å–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
   ```

2. –ë–æ—Ç –≤–µ–¥—ë—Ç –º–∞—Å—Ç–µ—Ä –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫.

3. –°–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –∏ –ø–∏—à–µ—Ç:

```
‚úÖ –ó–∞–¥–∞—á–∞ "–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö" —Å–æ–∑–¥–∞–Ω–∞.
–°—Å—ã–ª–∫–∞: https://ru.yougile.com/team/<team>/<slug>#<taskId>
```

4. –í—Å—ë, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤ —Ç—Ä–µ–¥–µ ‚Äî  
   –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç –∑–∞–¥–∞—á–∏ YouGile.

5. –ö–Ω–æ–ø–∫–∞ **¬´–ó–∞–≤–µ—Ä—à–∏—Ç—å¬ª** –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.

6. –ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç.

---

# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ –¥–µ—Ä–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ docker-compose ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env` –∏–ª–∏ Secrets
- –°—Ç–∞–≤—å—Ç–µ `restart: unless-stopped`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS

---

# ‚ùó –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ë–æ—Ç –ø–∏—à–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

```
üí• –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞: <—Ç–µ–∫—Å—Ç>
```

–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî traceback.